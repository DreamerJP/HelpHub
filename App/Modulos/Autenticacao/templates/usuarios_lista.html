{% extends "layout_base.html" %} {% from "componentes.html" import
render_paginacao, render_layout_erp, th_ordenavel, badge_perfil_usuario,
badge_status_cliente %} {% block title %}Equipe - HelpHub 4.0{% endblock %} {%
block page_title %} Gestão de Equipe
<span class="erp-subtitle hidden lg:inline-block"
  >Controle de acesso e usuários do sistema</span
>
{% endblock %} {% block content %} {% set toolbar_html %}
<div
  x-show="activeTab === 'ativos'"
  x-cloak
  class="flex items-center gap-2 w-full"
>
  <a href="{{ url_for('auth.novo_usuario') }}" class="erp-btn erp-btn-primary">
    <i class="ph ph-user-plus text-lg"></i> Novo Usuário
  </a>

  <div class="erp-separator"></div>

  <a
    :href="selectedItem ? '{{ url_for('auth.editar_usuario', id=0) }}'.replace('0', selectedItem.id) : '#'"
    :class="selectedItem ? '' : 'disabled'"
    class="erp-btn erp-btn-neutral"
  >
    <i class="ph ph-pencil-simple text-blue-600"></i> Editar
  </a>

  <!-- Botão Toggle Status -->
  <a
    :href="selectedItem ? '{{ url_for('auth.toggle_usuario', id=0) }}'.replace('0', selectedItem.id) : '#'"
    :class="selectedItem ? '' : 'disabled'"
    class="erp-btn erp-btn-neutral text-gray-700"
  >
    <i class="ph ph-toggle-left"></i> Ativar/Inativar
  </a>

  <div class="flex items-center gap-2 ml-auto">
    <div class="erp-badge-count">Total: {{ usuarios|length }} membros</div>
  </div>
</div>
{% endset %} {# --- LAYOUT ERP --- #} {% call render_layout_erp(
titulo="Equipe", abas=[ {'id': 'ativos', 'label': 'Usuários Ativos', 'icon':
'ph-users'}, {'id': 'placeholder', 'label': 'ADD NOVA ABA', 'icon':
'ph-plus-circle'} ], toolbar_buttons=toolbar_html ) %}

<!-- Grid de Dados -->
<div x-show="activeTab === 'ativos'" class="erp-grid-content">
  <table class="erp-table">
    <thead>
      <tr>
        <th style="width: 50px">#</th>
        {{ th_ordenavel('Nome Completo', 'nome', request.args.get('sort'),
        request.args.get('order')) }}
        <th>Usuário (Login)</th>
        <th>Email</th>
        <th>Perfil</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody>
      {% for usuario in usuarios %}
      <tr
        class="group cursor-pointer select-none"
        :class="{'selected': selectedItem && selectedItem.id == '{{ usuario.id }}'}"
        @click="toggleSelection({
                        id: '{{ usuario.id }}', 
                        nome: '{{ usuario.username }}'
                    })"
        @dblclick="window.location.href = '{{ url_for('auth.editar_usuario', id=usuario.id) }}'"
      >
        <td class="text-center text-gray-400 font-mono text-xs">
          {{ usuario.id }}
        </td>

        <td class="font-semibold text-gray-700">
          {{ usuario.nome_completo or usuario.username }}
        </td>

        <td class="font-mono text-blue-700">{{ usuario.username }}</td>

        <td class="text-gray-500">{{ usuario.email or '-' }}</td>

        <td>{{ badge_perfil_usuario(usuario.role) }}</td>
        <td>{{ badge_status_cliente(usuario.ativo) }}</td>
      </tr>
      {% else %}
      <tr>
        <td colspan="6" class="text-center py-12 text-muted">
          Nenhum usuário encontrado.
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <div class="erp-footer justify-end text-xs">
    Total: {{ usuarios|length }} membros
  </div>
</div>

<!-- Placeholder -->
<div
  x-show="activeTab === 'placeholder'"
  class="p-12 text-center text-gray-400"
>
  <i class="ph ph-plus-circle text-3xl mb-3 block opacity-50"></i>
  <p>Espaço reservado para novas funcionalidades.</p>
</div>

{% endcall %} {% endblock %}
